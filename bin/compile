#!/bin/sh

BUILD_ROOT=$1

indent() {
  sed -u 's/^/       /'
}

message() {
  echo "-----> $*"
}

# Install Jekyll into BUILD_ROOT/.gems
cat << EOF > ~/.gemrc
gemhome: $BUILD_ROOT/.gems
gempath:
- $BUILD_ROOT/.gems
EOF

message "Installing jekyll version 1.3.0"
gem install jekyll -v 1.3.0 --no-rdoc --no-ri | indent

message "Installing Liquid version 2.5.4"
gem install liquid -v 2.5.4 --no-rdoc --no-ri | indent

message "Installing redcarpet version 3.0.0"
gem install redcarpet -v 3.0.0 --no-rdoc --no-ri | indent

# Run Jekyll
message "Setting environment variables"
export GEM_HOME=$BUILD_ROOT/.gems
export PATH=$BUILD_ROOT/.gems/bin:$PATH
export LC_ALL=en_US.UTF8

message "Compiling Jekyll site"
$BUILD_ROOT/.gems/bin/jekyll --no-auto --no-server --no-lsi --safe | indent
